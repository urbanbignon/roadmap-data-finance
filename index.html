<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roadmap Data-Finance</title>
  <style>
    body {
      font-family: 'Segoe UI', Roboto, sans-serif;
      background: #f7f9fb;
      color: #222;
      margin: 0;
      padding: 0;
    }
    header {
      background: #016464;
      color: white;
      padding: 20px;
      text-align: center;
    }
    main {
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    h2 {
      color: #016464;
      border-bottom: 2px solid #016464;
      padding-bottom: 5px;
    }
    .mois {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .projet {
      display: flex;
      align-items: center;
      margin: 8px 0;
    }
    input[type="checkbox"] {
      transform: scale(1.3);
      margin-right: 10px;
    }
    .progress-bar {
      background: #ddd;
      border-radius: 10px;
      height: 10px;
      margin-top: 10px;
      overflow: hidden;
    }
    .progress {
      background: #016464;
      height: 10px;
      width: 0%;
      transition: width 0.3s ease;
    }
  </style>
</head>
<script>
// Sauvegarde de la progression dans le navigateur
document.addEventListener("DOMContentLoaded", () => {
  const checkboxes = document.querySelectorAll("input[type='checkbox']");
  const progressBars = document.querySelectorAll(".progress");

  // Charger les Ã©tats sauvegardÃ©s
  checkboxes.forEach((box, i) => {
    const saved = localStorage.getItem(`roadmap_check_${i}`);
    if (saved === "true") box.checked = true;
  });

  // Mettre Ã  jour les barres
  updateProgress();

  // Quand on coche/dÃ©coche
  checkboxes.forEach((box, i) => {
    box.addEventListener("change", () => {
      localStorage.setItem(`roadmap_check_${i}`, box.checked);
      updateProgress();
    });
  });

  // Calcul du pourcentage total
  function updateProgress() {
    const total = checkboxes.length;
    const done = [...checkboxes].filter(b => b.checked).length;
    const pct = (done / total) * 100;
    progressBars.forEach(bar => (bar.style.width = `${pct}%`));
  }
});
</script>
<button id="btn-ics" style="position:fixed;right:16px;bottom:16px;padding:10px 14px;border:0;border-radius:10px;background:#016464;color:#fff;cursor:pointer">
  ðŸ“… Ajouter au Calendrier (ICS)
</button>

<script>
// ---- utilitaires calendrier ----
const MONTHS_FR = {
  "janvier":1,"fÃ©vrier":2,"fevrier":2,"mars":3,"avril":4,"mai":5,"juin":6,
  "juillet":7,"aoÃ»t":8,"aout":8,"septembre":9,"octobre":10,"novembre":11,"dÃ©cembre":12,"decembre":12
};
function lastDayOfMonth(year, month){ return new Date(year, month, 0).getDate(); }
function yyyymmdd(d){ const y=d.getFullYear();
  const m=String(d.getMonth()+1).padStart(2,"0");
  const day=String(d.getDate()).padStart(2,"0");
  return `${y}${m}${day}`; }
function uid(){ return (Math.random().toString(36).slice(2)) + "@roadmap-data-finance"; }

// ---- collecte tÃ¢ches cochÃ©es + gÃ©nÃ©ration ICS all-day par mois ----
document.getElementById("btn-ics").addEventListener("click", () => {
  // annÃ©e cible (celle affichÃ©e dans ton site ; sinon annÃ©e courante)
  const year = new Date().getFullYear();

  // Chaque "mois" est un bloc avec un <h2> contenant le nom du mois
  const sections = document.querySelectorAll(".mois");
  const events = [];

  sections.forEach(sec => {
    const h2 = sec.querySelector("h2");
    if(!h2) return;
    const moisTxt = h2.textContent.toLowerCase();
    const match = Object.keys(MONTHS_FR).find(k => moisTxt.includes(k));
    if(!match) return;
    const month = MONTHS_FR[match];

    // date = dernier jour du mois (Ã©vÃ©nement sur la journÃ©e)
    const day = lastDayOfMonth(year, month);
    const dt = new Date(year, month-1, day);

    // tÃ¢ches cochÃ©es dans cette section
    const items = sec.querySelectorAll("input[type='checkbox']");
    items.forEach(cb => {
      if(cb.checked){
        // Texte de la tÃ¢che : cherche le label associÃ©
        let title = "TÃ¢che roadmap";
        const label = cb.closest("label") || cb.parentElement;
        if(label) title = label.innerText.trim();

        events.push({
          title,
          date: yyyymmdd(dt),
          notes: "Roadmap Data & Finance â€” urbanbignon.github.io/roadmap-data-finance/"
        });
      }
    });
  });

  if(events.length === 0){
    alert("Coche au moins une tÃ¢che avant dâ€™exporter ðŸ˜‰");
    return;
  }

  // Construire le .ics
  let ics = "BEGIN:VCALENDAR\r\nVERSION:2.0\r\nPRODID:-//Roadmap Data Finance//FR\r\nCALSCALE:GREGORIAN\r\nMETHOD:PUBLISH\r\n";
  const now = yyyymmdd(new Date()) + "T000000Z";

  events.forEach(ev => {
    ics += "BEGIN:VEVENT\r\n";
    ics += `UID:${uid()}\r\n`;
    ics += `DTSTAMP:${now}\r\n`;
    // All-day event : DTSTART/DTEND au format YYYYMMDD (DTEND exclusif => +1 jour)
    ics += `DTSTART;VALUE=DATE:${ev.date}\r\n`;
    // +1 jour
    const yyyy = parseInt(ev.date.slice(0,4),10);
    const mm = parseInt(ev.date.slice(4,6),10);
    const dd = parseInt(ev.date.slice(6,8),10);
    const end = new Date(yyyy, mm-1, dd+1);
    ics += `DTEND;VALUE=DATE:${yyyymmdd(end)}\r\n`;
    ics += `SUMMARY:${ev.title.replace(/[\r\n]/g," ")}\r\n`;
    ics += `DESCRIPTION:${ev.notes.replace(/[\r\n]/g," ")}\r\n`;
    ics += "END:VEVENT\r\n";
  });

  ics += "END:VCALENDAR\r\n";

  // TÃ©lÃ©charger
  const blob = new Blob([ics], {type:"text/calendar;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "roadmap.ics"; document.body.appendChild(a);
  a.click(); a.remove();
  URL.revokeObjectURL(url);
  alert("Fichier ICS gÃ©nÃ©rÃ©. Ouvre-le sur iPhone pour lâ€™ajouter au Calendrier.");
});
</script>

  <body>
  <header>
    <h1>ðŸ“Š Roadmap Data & Finance</h1>
    <p>Suivi de progression de mes projets</p>
  </header>

  <main id="roadmap"></main>

  <script>
    const roadmap = [
      {
        mois: "Janvier",
        theme: "Fondations & Setup",
        projets: [
          "Installer Python, VS Code, GitHub",
          "CrÃ©er un repo GitHub et publier un mini projet",
          "Apprendre HTML / CSS / JS de base",
          "DÃ©couvrir les librairies Python pour la data : Pandas, Numpy"
        ]
      },
      {
        mois: "FÃ©vrier",
        theme: "Data Science FinanciÃ¨re",
        projets: [
          "Collecter et nettoyer des donnÃ©es financiÃ¨res (Yahoo Finance API)",
          "CrÃ©er un tableau de bord simple avec Power BI ou Streamlit",
          "Analyser les sÃ©ries temporelles de cours boursiers",
          "Lire un rapport financier (Bilan et Compte de rÃ©sultat)"
        ]
      },
      {
        mois: "Mars",
        theme: "Finance & Risques",
        projets: [
          "Ã‰tudier la Value-at-Risk (VaR)",
          "Construire un modÃ¨le de risque de portefeuille",
          "Simuler des scÃ©narios de marchÃ© avec Python",
          "Automatiser une alerte de risque (volatilitÃ©, drawdown)"
        ]
      }
    ];

    const roadmapDiv = document.getElementById('roadmap');

    function loadProgress() {
      const saved = localStorage.getItem('progress');
      return saved ? JSON.parse(saved) : {};
    }

    function saveProgress(progress) {
      localStorage.setItem('progress', JSON.stringify(progress));
    }

    const progress = loadProgress();

    roadmap.forEach((mois) => {
      const moisDiv = document.createElement('div');
      moisDiv.className = 'mois';
      const titre = document.createElement('h2');
      titre.textContent = `${mois.mois} â€” ${mois.theme}`;
      moisDiv.appendChild(titre);

      const projetsContainer = document.createElement('div');
      let doneCount = 0;

      mois.projets.forEach((projet) => {
        const projetDiv = document.createElement('div');
        projetDiv.className = 'projet';
        const check = document.createElement('input');
        check.type = 'checkbox';
        const id = `${mois.mois}-${projet}`;
        check.checked = progress[id] || false;
        check.addEventListener('change', () => {
          progress[id] = check.checked;
          saveProgress(progress);
          updateProgressBar();
        });
        const label = document.createElement('label');
        label.textContent = projet;
        projetDiv.appendChild(check);
        projetDiv.appendChild(label);
        projetsContainer.appendChild(projetDiv);
        if (check.checked) doneCount++;
      });

      moisDiv.appendChild(projetsContainer);

      const progressBarContainer = document.createElement('div');
      progressBarContainer.className = 'progress-bar';
      const progressBar = document.createElement('div');
      progressBar.className = 'progress';
      progressBarContainer.appendChild(progressBar);
      moisDiv.appendChild(progressBarContainer);

      roadmapDiv.appendChild(moisDiv);

      function updateProgressBar() {
        const total = mois.projets.length;
        const done = mois.projets.filter(p => progress[`${mois.mois}-${p}`]).length;
        progressBar.style.width = `${(done / total) * 100}%`;
      }

      updateProgressBar();
    });
  </script>
</body>
</html>
